# Multiphysics model

*Contact: Nicolas Stauff, nstauff.at.anl.gov*
*         Yinbin Miao, ymiao.at.anl.gov*

## Mesh File

As a series of powerful reactor-focused mesh generators have been implemented into MOOSE as the [Reactor Module](https://mooseframework.inl.gov/modules/reactor/index.html) [!citep](shemon2022moose), the meshing tool used for the HP-MR simulation has been transit from [Cubit](https://cubit.sandia.gov/) to MOOSE's intrinsic mesh generator set. 

While Sockeye uses its own simple implemented 2D axisymetric heat pipe meshing capabilities, both Griffin and BISON applications adopt meshes generated by MOOSE's intrinsic mesh generators in this HP-MR model. The input file used to generate the mesh is listed as follows.

!listing /mrad/mesh/HPMR_OneSixth_Core_meshgenerator_tri.i max-height = 10000

!media media/mrad/hpmr_mesh_proc.png
       style=display: block;margin-left:auto;margin-right:auto;width:90%;
       id=hpmr_mesh_proc
       caption=A cartoon showing the step-by-step procedures to generate the HP-MR mesh.

A 1/6 HP-MR core was generated using the input file shown above with steps illustrated in [hpmr_mesh_proc]. This mesh contains stainless steel envelops for moderators and heat pipes, while the helium gap is not meshed. The mesh density in radial direction is high as multiple small features (fuel rods, moderators, heat pipes and control drums) are involved. As the heat flux across the interfaces between the reactor matrix and heat pipe outer surface is crucial, the `boundary layer` feature available in the [Reactor Module](https://mooseframework.inl.gov/modules/reactor/index.html) can optionally be used to create finer meshes near the interfaces. Note that this feature is not selected in the simulation results shown in this documentation.

Compared with the mesh used in the [legacy model](/legacy_mrad_model.md) and created from Cubit:

    - An outer surface zone surrounding the reflectors was added to provide the appropriate convex boundary for neutronic calculation.

    - The mesh was adjusted to preserve the actual physical volume of each material region.

## Multiphysics Model Setup

### Griffin Model

Griffin is used to govern the neutronics of the HP-MR as the parent application of the multiphysics simulation.

A Monte Carlo Serpent-2 model has been setup to simulate the double heterogeneity of the HP-MR full core explicitly with the most recent ENDF/B-8.0 cross section data sets. This Monte Carlo model is used not only to provide reference solutions to the Griffin neutronics model for multiphysics simulations, but also to generate condensed multigroup cross sections for Griffin. In particular, multigroup cross sections were generated for each material zone by tallying the average reaction rates and group fluxes within that material region in Serpent-2 criticality calculations. Different sets of cross sections were prepared with fuel and moderator temperatures ($T_f$ and $T_m$) assumed at 600 K, 700 K, 800 K, 1000 K and 1200 K respectively. These cross-section sets were then read by the ISOXML utility module in Griffin to create a bi-dimension cross section table which was used in the multiphysics coupled transient simulations.

The CFEM-SN(1,3) neutronics solver without acceleration in Griffin is used in this model. The DFEM-SN neutronics solver with acceleration will be used in a future version of this model.

!listing /mrad/steady/HPMR_cfem_griffin_ss.i max-height = 10000

### BISON Model

BISON is used to simulate thermal physics of the 1/6 HP-MR core as a child application, as it is equipped with a comprehensive set of thermophysical properties of relevant nuclear materials, especially the TRISO-loaded graphite and 316SS.

As the heat pipe behavior is simulated by Sockeye, the heat pipe blocks are removed from the mesh used by BISON. The thermal behavior of the rest of the HP-MR core is dominated by heat conduction. Convective boundary conditions were defined at the top and bottom of the model with an external temperature of 800 K and a heat transfer coefficient (HTC) of 100 W/m^2^•K.

!listing /mrad/steady/HPMR_thermo_ss.i max-height = 10000

### Sockeye Model

For each heat pipe in the 1/6 HP-MR core, a Sockeye grandchild application is used to calculate its thermal performance.

The effective thermal conductivity model, i.e., a 2D axisymmetric conduction model with a very high thermal conductivity of 2×10^5^ W/m•K is applied to the vapor core. A heat flux boundary condition is applied to the exterior of the casing in the evaporator section, which is provided by the bulk conduction model. A convective boundary condition is applied to the exterior of the envelope in the condenser section, with an external temperature of 800 K and a heat transfer coefficient (HTC) of 10^6^ W/m^2^•K (the value is intentially set high to achieve an effective Dirichlet boundary condition).

!listing /mrad/steady/HPMR_sockeye_ss.i max-height = 10000

### MultiApps Hierarchy

The three MOOSE applications that governs different physics respectively are coupled together leveraging the MOOSE MultiApps system. Each code has its own mesh and corresponding space and time scales. The MOOSE MultiApp system is used to tightly couple the different codes via fixed point iterations as illustrated below in [hpmr_multiapps].

At the top level, Griffin calculates the power density based on its neutronics results given the fuel and moderator temperatures taken from the BISON child application. The calculated power density is also provided to BISON to update the temperature calculation. On the other hand, for the surface of each heat pipe, BISON calculates the layered average heat flux along the normal direction of the surface and transfers the 1D field values to the respective Sockeye sub-application so that Sockeye can use them as its boundary condition. Meanwhile, BISON takes the heat pipe surface temperature calculated by Sockeye back for its own boundary condition on the heat pipe surface.

!media media/mrad/multiapps.png
       style=display: block;margin-left:auto;margin-right:auto;width:60%;
       id=hpmr_multiapps
       caption=MultiApps hierarchy of the HP-MR multiphysics simulations.

## Simulation Cases

Three different scenarios are simulated in this HP-MR model. The most fundamental case is the steady state operation of the HP-MR, where the thermal power of the full reactor core is preset as 2.07 MW (i.e., 345.6 kW per 1/6 core). Using the steady state simulation results as the reference case, two different transient scenarios are also simulated: a load following transient and a transient event initiated by the failure of a single heat pipe.

### Steady State Operation

For steady state simulation, the Griffin parent application performs an Eigenvalue calculation with a fixed preset integrated power (345.6 kW) to compute $k_{eff}$ as well as the shape of power distribution. In the meantime, the BISON child application works with multiple Sockeye grandchild sub-applications to perform transient thermal calculation using the given power density distribution until a thermal equilibrium is achieved. Once the fixed point iteration between different levels of MultiApps is converged, the steady state operation condition of the HP-MR at the given power level is obtained.

Optionally, the fixed preset integrated power level can be raised to force the HP-MR to operate at an overpower level. This is useful to demonstrate the capabilities of the NEAMS codes to predict some types of power transients that only occurs in the case of overpowered operation, such as the heat pipe cascade failure event to be demonstrated in this model.

### Load Following Transient

The load following transient is initiated by introducing a drop in the heat removal capability of the secondary coolant loop that transfer the heat from the condensor regions of the heat pipes to either a heat exchanger or directly to the energy coversion component. During steady state operation, a high heat transfer coefficient (HTC) of 10^6^ W/m^2^•K is used on the outer surface of the heat pipe condensor region. To initiate the load following transient event, the HTC value is reduced by 99.99% to 10^2^ W/m^2^•K to mimic a load reduction event. The same transient solving approach is used for BISON and Sockeye applications. However, instead of an Eigenvalue calculation, Griffin here also performs transient calculation. Based on the changes in $k_{eff}$ induced by temperature evolution calculated by BISON/Sockeye, Griffin predicts the corresponding kinetics of neutronics and consequent power distribution.

### Transient Initiated by a Single Heat Pipe Failure

Another type of transient to be simulated in this model is more localized. Instead of reducing the condensor region HTC of all heat pipes, the condensor region HTC of a single heat pipe is nearly eliminated (i.e. reduced from 10^6^ W/m^2^•K to 10^-2^ W/m^2^•K) to mimic a single heat pipe failure event, while the other heat pipes are kept unchanges (note that actually there are six heat pipes that are compromised due to the 1/6 symmetric mesh used here in this model). The failed heat pipe is intentially selected to be in the hottest region of the HP-MR (i.e., in the center region of the center assembly).

#### Localized Single Heat Pipe Failure

The favored consequence of a single heat pipe failure in an HP-MR is that the extraneous heat that was removed by the failed heat pipe can be removed by the surrounding functioning heat pipes. In that case, the effects of the failed heat pipe are localized and the average core temperature only experiences a very minor increase. As a result, the HP-MR can still operate normally with a minor decrease in power. Ideally, the designed HP-MR power need to be set at an appropriate level that a single heat failure can be localized. Therefore, this is the expected simulation result for the HP-MR operating at the designed power level.

#### Heat Pipe Cascade Failure

On the other hand, when the HP-MR is operating at an overpower level (e.g., 780 kW in this model), the heat pipes in the hottest region are already operaing at a heat removal rate very close to their operating limits. Therefore, if a single heat pipe fails, its surrounding heat pipes will exceed their operating limits and then fail subsequently. This kind of failure events will then spread to a wider range and lead to heat pipe cascade failure. As a significant fraction of the heat pipes in an HP-MR fail, the average core temperature increases prominently and leads to a major power drop. Consequently, the HP-MR can no longer maintain its normal operation. A reliable HP-MR model should be able to predict such an unfavored transient event. In this model, the HP-MR is also intentionally set to run at an overpower of 780 kW before a single heat pipe failure is introduced to demonstrate such modeling capability.

## Guidance of Running Different Simulation Cases

Fist of all, the user need to run the mesh generation input [file](/mrad/mesh/HPMR_OneSixth_Core_meshgenerator_tri.i) to generate the needed EXODUS mesh file that is required by all the multiphysics simulation cases. The mesh generation input file only uses objects available in MOOSE Framework and the Reactor Module. So the file can be run by any MOOSE applications that compiled with the Reactor Module, such as Griffn. The example command to generate the mesh EXODUS file is list as follows:

!listing language=bash
cd /mrad/mesh
griffin-opt -i HPMR_OneSixth_Core_meshgenerator_tri.i --mesh-only HPMR_OneSixth_Core_meshgenerator_tri_rotate_bdry.e

Then, the steady state simulation can be run. As the output files of the steady state simulation are already required as the initial status of the transient simulations, it is also required to be run before any transient simulations. The multiphysics steady state simulation uses Griffin, BISON and Sockeye objects. Therefore, users should use a super application that covers these three applications, such as DireWolf or BlueCRAB (compiled with Sockeye included). The example command to run the steady state simulation is shown as folllows:

!listing language=bash
cd /mrad/steady
mpirun -n 40 dire_wolf-opt -i HPMR_cfem_griffin_ss.i

With the EXODUS and checkpoint output file of the steady state simulation, the transient simulatons can be run. Before running any real cases, it is recommended to verify that the steady state obtained is correct. To do this, a null transient (i.e., a time dependent simulation with exactly the same conditions as the steady state simulation). If the steady state is correct, the null transient should yield constant values for all time-dependent quantities. The application needed to run transient simulations should be the same as the one used to obtain the steady state. The example command to run the null transient simulation is shown as folllows:

!listing language=bash
cd /mrad/transient_null
mpirun -n 40 dire_wolf-opt -i HPMR_cfem_griffin_trN.i

Once the steady state obtained is verified, the real transient cases can be run using the similar approach.

!listing language=bash
cd /mrad/load_following
mpirun -n 40 dire_wolf-opt -i HPMR_cfem_griffin_tr.i

!listing language=bash
cd /mrad/heat_pipe_failure
mpirun -n 40 dire_wolf-opt -i HPMR_cfem_griffin_tr.i

### Overpower Simulation

The default power values in the input files in this repository are all set at the nominal power (i.e., 345.6 kW for the 1/6 HP-MR core). To run the overpower case to simulate the heat pipe cascade failure, the following values need to be changed to the 780 kW overpower level.

!listing /mrad/steady/HPMR_cfem_griffin_ss.i block=PowerDensity

!listing /mrad/transient_null/HPMR_cfem_griffin_trN.i block=PowerDensity

!listing /mrad/heat_pipe_failure/HPMR_cfem_griffin_tr.i block=PowerDensity
